print("Wiretapper by jlortiz")
print("Please enter the side your modem is on")
print("You will lose rednet.")
local side=read()
if rednet.isOpen(side) then rednet.close(side) end
local modem = peripheral.wrap(side)
if not modem.isWireless() then
print("Warining: This is a wired modem and may not work for wiretapping.")
print("Type anything and press enter to proceed, type nothing and press enter to cancel.")
if read()=="" then return end
end
write("Computer ID to wiretap:")
local side = read()
if tonumber(side) > 65532 or tonumber(side)<0 then error("This computer id is invalid.") end
modem.open(tonumber(side))
write("Output to FILE or SCREEN?")
if read()=="file" then
write("Save to which file?")
file=fs.open(read(), "a")
local function log()
while true do 
local event, side, sent, reply, msg, distance = os.pullEvent("modem_message")
file.writeLine(sent.." got message from "..reply)
file.writeLine("Day "..os.day()..", time "..textutils.formatTime(os.time()))
if type(msg)=="table" then file.writeLine(textutils.serialise(msg)) end
end
end
local function runshell() shell.run("shell") end
print("Logging will continue until the current shell/tab is closed.")
print("DO NOT RUN REDNET IN THIS SHELL.")
parallel.waitForAny(runshell, log)
print("Wiretap closing...")
file.close()
else
print("Waiting for messages, Control+T to terminate.")
while true do
local event, side, sent, reply, msg, distance = os.pullEvent("modem_message")
print(sent.." got message from "..reply)
if type(msg)=="table" then
print(textutils.serialise(msg))
else print(msg) end end end

