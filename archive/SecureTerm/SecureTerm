local pullold=os.pullEvent
os.pullEvent=os.pullEventRaw
term.clear()
term.setCursorPos(1,1)
local setting=fs.open("/secure.config", "r")
setting.readLine()
setting.readLine()
setting.aun=setting.readLine()
setting.apw=setting.readLine()
setting.readLine()
setting.guest=setting.readLine()
setting.readLine()
setting.create=setting.readLine()
setting.close()
if fs.exists("/secacct/queue") then
local h = fs.open("/secacct/queue", "r")
local f=h.readLine()
repeat
fs.delete("/secacct/"..f)
f=h.readLine()
until f==nil
h.close()
fs.delete("/secacct/queue")
f=nil
end
print("You must login to use this computer.")
write("Username:")
os.user=read()
if os.user=="guest" then
if setting.guest=="true" then
fs.delete("/secacct/guest")
fs.makeDir("/secacct/guest")
shell.setDir("/secacct/guest")
print("All files will be lost when you leave.")
shell.setPath(".:/secprog:/rom/programs:rom/programs/fun:/rom/programs/rednet:/rom/programs/http")
else 
print("Guest user not allowed")
sleep(2)
os.shutdown()
end
elseif os.user==setting.aun then 
write("Password:")
if read("*") == setting.apw then
os.user=nil
else 
print("Invalid password.")
sleep(2)
os.shutdown()
end
else
if fs.exists("/secacct/"..os.user) then
h=fs.open("/secacct/"..os.user.."/.password", "r")
write("Password:")
if read("*") == h.readAll() then
h.close()
shell.setDir("/secacct/"..os.user)
shell.setPath(".:/secprog:/rom/programs:/rom/programs/fun:/rom/programs/rednet:/rom/programs/http")
else
print("Invalid password")
sleep(2)
os.shutdown()
end
else
if setting.create=="true" then
print("Account does not exist. Create it?")
write("Yes/No:")
if read()=="Yes" then
write("Password:")
local pass=read("*")
write("Confirm Password:")
if not pass==read("*") then
print("Passwords do not match.")
sleep(2)
os.shutdown()
else
fs.makeDir("/secacct/"..os.user)
local h=fs.open("/secacct/"..os.user.."/.password", "w")
h.write(pass)
h.close()
print("Sucess, please login.")
shell.run("secure")
end
else os.shutdown() end
else
print("No such user.")
sleep(2)
os.shutdown()
end
end
end
os.pullEvent=pullold
