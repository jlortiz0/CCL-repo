if string.find(system.dir, "disk") then --else
  print("This program is for use on install disks only.")
  return
end

local n = system.drawMenu({"Install", "Don't"}, "This program will install SimOS on your computer.\nProceed?\n")
if n==1 then
  while true do
    print("Please type in the install dir:")
    write("/")
    local idir = "/"..read().."/SimOS/"
    if system.drawMenu({"Yes", "No"}, "SimOS will be installed in "..idir..".\n")==1 then break end
  end
  local options = {{true, true, true, false}, {"Help files and other documentation", "Custom disk bootloader", "Run on computer start", "24 hour time"}}
  local n=1
  while true do
    local opt = {}
    for i=1, #options[1] do
      if options[1][i] then
        table.insert(opt, "[*]"..options[2][i])
      else
        table.insert(opt, options[2][i])
      end
    end
    table.insert(opt, "Done")
    n=system.drawMenu(opt, "Select additional items to install:\n", n)
    if n==#opt then break end
    if options[1][n] then
      options[1][n]=false
    else
      options[1][n]=true
    end
  end
  options = options[1]
  if options[1] then
    shell.run("copy "..system.dir.."/help /"..idir.."/help")
  end
  if options[2] then
    shell.run("set shell.allow_disk_startup false")
  end
  if options[3] then
    shell.run("set shell.allow_startup true")
    local h = fs.open("/startup","a")
    h.writeLine("\n--Start SimOS\nshell.run("..idir.."/SimOS)")
    h.close()
  end
  local h = fs.open(system.dir.."/registry", "r")
  local reg = textutils.unserialize(h.readAll())
  h.close()
  if options[4] then
    reg.24hr = true
  end
  table.remove(registry.programs, 1)
  while true do
    print("You need to set an administrator password:")
    local pass = read("*")
    write("Confirm password:")
    if read("*")~=pass then
      print("Passwords do not match, try again.")
    else
      reg.apass=pass
      break
    end
  end
  fs.copy(system.dir.."/SimOS", idir.."/SimOS")
  shell.run("copy "..system.dir.."/programs /"..idir.."/programs")
  fs.delete(idir.."/programs/installer")
  fs.makeDir(idir.."/startup")
  h = fs.open(idir.."/registry", "w")
  h.write(textutils.serialize(registry))
  h.close()
  print("The installation is complete.")
  if options[3] then
    print("Please remove the disk and press any key to continue...")
    os.pullEvent("key")
    os.reboot()
  else
    print("Now returning to the SimOS demo disk...")
    sleep(1)
    return
  end
end
